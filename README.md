# PostgreSQL 16 Configuration Playbook for Debian

Этот репозиторий содержит Ansible плейбук, который автоматизирует установку и настройку PostgreSQL 16 на свежеустановленном сервере Debian. Плейбук включает в себя настройку конфигурации PostgreSQL, установку необходимых зависимостей, а также настройку параметров системы для оптимальной работы базы данных. Плейбук подготовлен в качестве тестового задания с нуля, не имея никаких практических навыков по работе с Ansible.

## Требования

Для использования этого плейбука вам необходимо:

- Свежеустановленный минимальный сервер Debian
- Доступ к серверу через SSH
- Учетная запись root с установленным паролем

## Инструкция по использованию

### Шаг 1: Настройка инвентори-файла

1. Скопируйте файл `inventory.ini.example` в файл `inventory.ini`.
2. Внесите изменения в файл `inventory.ini`, заменив данные на свои.

Пример:

```ini
[dbservers]
db1 ansible_host=192.168.122.226 ansible_become_pass={{ become_pass }}
```

### Шаг 2: Настройка параметров PostgreSQL

1. Измените значения в файле `postgresql_config.yml`, если требуется. Например:

```yaml
postgresql:
  source_ip: 0.0.0.0/0          # Это разрешит доступ со всех IP
  max_connections: 100
  temp_buffers: 32MB
  work_mem: 32MB
  maintenance_work_mem: 2GB
```

### Шаг 3: Запуск плейбука

1. Запустите плейбук с помощью следующей команды:

```bash
ansible-playbook -i inventory.ini setup.yml
```

2. Если у вас настроен SSH доступ с паролем, можно дополнительно использовать флаг `--ask-pass`.

### Шаг 4: Проверка подключения к PostgreSQL

После успешного выполнения плейбука, PostgreSQL будет настроен для внешних подключений. Фаервол настроен для подключений к базе данных и сессий SSH. Вы можете подключиться к базе данных, используя команду:

```bash
psql -h 192.168.122.226 -U postgres
```

Важно! Пароль пользователя `postgres` по умолчанию — `postgres`. **Не забудьте сменить его после первого подключения**.

### Важное примечание

- Плейбук разрешает внешние подключения к PostgreSQL с любого IP (если вы не измените параметр `source_ip`), но это может представлять угрозу безопасности. **Обязательно измените пароль пользователя `postgres` и настройте более строгие правила для доступа в файле `pg_hba.conf`**.
